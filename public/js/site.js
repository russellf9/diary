"use strict";var myApp=angular.module("myApp",["myApp.config","myApp.controllers","myApp.decorators","myApp.directives","myApp.filters","myApp.routes","myApp.services"]).run(["simpleLogin",function(p){console.log("run"),p.getUser()}]);
"use strict";angular.module("myApp.config",[]).constant("version","0.8.2").constant("loginRedirectPath","/login").constant("FBURL","https://f9fb1.firebaseio.com").run(["FBURL","$timeout",function(n,e){n.match("//INSTANCE.firebaseio.com")&&(angular.element(document.body).html("<h1>Please configure app/js/config.js before running!</h1>"),e(function(){angular.element(document.body).removeClass("hide")},250))}]);
"use strict";var myAppControllers=angular.module("myApp.controllers",["firebase.utils","simpleLogin"]).controller("HomeCtrl",["$scope","fbutil","user","FBURL",function(e,n,o,r){e.syncedValue=n.syncObject("syncedValue"),e.user=o,e.FBURL=r}]).controller("ChatCtrl",["$scope","messageList",function(e,n){e.messages=n,e.addMessage=function(n){n&&e.messages.$add({text:n})}}]).controller("LoginCtrl",["$scope","simpleLogin","$location",function(e,n,o){function r(){return e.email?e.pass&&e.confirm?e.createMode&&e.pass!==e.confirm&&(e.err="Passwords do not match"):e.err="Please enter a password":e.err="Please enter an email address",!e.err}function l(e){return angular.isObject(e)&&e.code?e.code:e+""}e.email=null,e.pass=null,e.confirm=null,e.createMode=!1,e.login=function(r,t){e.err=null,n.login(r,t).then(function(){o.path("/account")},function(n){e.err=l(n)})},e.createAccount=function(){e.err=null,r()&&n.createAccount(e.email,e.pass).then(function(){o.path("/account")},function(n){e.err=l(n)})}}]).controller("AccountCtrl",["$scope","simpleLogin","fbutil","user","$location",function(e,n,o,r,l){function t(){e.err=null,e.msg=null,e.emailerr=null,e.emailmsg=null}var s=o.syncObject(["users",r.uid]);s.$bindTo(e,"profile"),e.logout=function(){s.$destroy(),n.logout(),l.path("/login")},e.changePassword=function(o,r,l){t(),o&&r&&l?l!==r?e.err="New pass and confirm do not match":n.changePassword(s.email,o,l).then(function(){e.msg="Password changed"},function(n){e.err=n}):e.err="Please fill in all password fields"},e.clear=t,e.changeEmail=function(r,l){t(),s.$destroy(),n.changeEmail(r,l).then(function(n){s=o.syncObject(["users",n.uid]),s.$bindTo(e,"profile"),e.emailmsg="Email changed"},function(n){e.emailerr=n})}}]);
angular.module("myApp.decorators",["firebase.utils","simpleLogin"]).config(["$provide",function(e){e.decorator("ngCloakDirective",["$delegate","simpleLogin",function(e,i){var o=e[0],n=o.compile;return o.compile=function(e,r){i.getUser().then(function(){n.call(o,e,r)})},e}])}]);
"use strict";angular.module("myApp.directives",["simpleLogin"]).directive("appVersion",["version",function(n){return function(t,i){i.text(n)}}]).directive("ngShowAuth",["simpleLogin","$timeout",function(n,t){var i;return n.watch(function(n){i=!!n}),{restrict:"A",link:function(c,o){function e(){t(function(){o.toggleClass("ng-cloak",!i)},0)}o.addClass("ng-cloak"),e(),n.watch(e,c)}}}]).directive("ngHideAuth",["simpleLogin","$timeout",function(n,t){var i;return n.watch(function(n){i=!!n}),{restrict:"A",link:function(c,o){function e(){o.addClass("ng-cloak"),t(function(){o.toggleClass("ng-cloak",i!==!1)},0)}e(),n.watch(e,c)}}}]);
"use strict";angular.module("myApp.filters",[]).filter("interpolate",["version",function(e){return function(r){return String(r).replace(/\%VERSION\%/gm,e)}}]).filter("reverse",function(){return function(e){return e.slice().reverse()}});
"use strict";angular.module("myApp.routes",["ngRoute","simpleLogin"]).constant("ROUTES",{"/home":{templateUrl:"partials/home.html",controller:"HomeCtrl",resolve:{user:["simpleLogin",function(t){return t.getUser()}]}},"/chat":{templateUrl:"partials/chat.html",controller:"ChatCtrl"},"/login":{templateUrl:"partials/login.html",controller:"LoginCtrl"},"/contacts":{templateUrl:"partials/contacts.html",controller:"ContactsCtrl"},"/account":{templateUrl:"partials/account.html",controller:"AccountCtrl",authRequired:!0}}).config(["$routeProvider",function(t){t.whenAuthenticated=function(e,r){r.resolve=r.resolve||{},r.resolve.user=["requireUser",function(t){return t()}],t.when(e,r)}}]).config(["$routeProvider","ROUTES",function(t,e){angular.forEach(e,function(e,r){e.authRequired?t.whenAuthenticated(r,e):t.when(r,e)}),t.otherwise({redirectTo:"/home"})}]).run(["$rootScope","$location","simpleLogin","ROUTES","loginRedirectPath",function(t,e,r,o,n){function l(t){!t&&a(e.path())&&e.path(n)}function a(t){return o.hasOwnProperty(t)&&o[t].authRequired}r.watch(l,t),t.$on("$routeChangeError",function(t,r,o,l){angular.isObject(l)&&l.authRequired&&e.path(n)})}]);
!function(){"use strict";angular.module("myApp.services",[]).factory("messageList",["fbutil",function(t){return t.syncArray("messages",{limit:10,endAt:null})}]).factory("contactsList",["fbutil",function(t){return t.syncArray("contacts",{limit:50,endAt:null})}])}();
angular.module("firebase.utils",["firebase","myApp.config"]).factory("fbutil",["$window","FBURL","$firebase",function(r,n,e){"use strict";function t(r){for(var n=0;n<r.length;n++)if(angular.isArray(r[n]))r[n]=t(r[n]);else if("string"!=typeof r[n])throw new Error("Argument "+n+" to firebaseRef is not a string: "+r[n]);return r.join("/")}function a(){var e=new r.Firebase(n),a=Array.prototype.slice.call(arguments);return a.length&&(e=e.child(t(a))),e}function i(r,n){var t=a(r);return n=angular.extend({},n),angular.forEach(["limit","startAt","endAt"],function(r){if(n.hasOwnProperty(r)){var e=n[r];t=t[r].apply(t,angular.isArray(e)?e:[e]),delete n[r]}}),e(t,n)}return{syncObject:function(){return i.apply(null,arguments).$asObject()},syncArray:function(){return i.apply(null,arguments).$asArray()},ref:a}}]);
angular.module("simpleLogin",["firebase","firebase.utils","changeEmail"]).factory("requireUser",["simpleLogin","$q",function(e,n){return function(){return e.getUser().then(function(e){return e?e:n.reject({authRequired:!0})})}}]).factory("simpleLogin",["$firebaseSimpleLogin","fbutil","createProfile","changeEmail","$q","$rootScope",function(e,n,r,t,i,o){function u(){s.getUser().then(function(e){s.user=e||null,angular.forEach(f,function(n){n(e||null)})})}var c=e(n.ref()),f=[],s={user:null,getUser:function(){return c.$getCurrentUser()},login:function(e,n){return c.$login("password",{email:e,password:n,rememberMe:!0})},logout:function(){c.$logout()},createAccount:function(e,n,t){return c.$createUser(e,n).then(function(){return s.login(e,n)}).then(function(n){return r(n.uid,e,t).then(function(){return n})})},changePassword:function(e,n,r){return c.$changePassword(e,n,r)},changeEmail:function(e,n){return t(e,s.user.email,n,this)},removeUser:function(e,n){return c.$removeUser(e,n)},watch:function(e,n){s.getUser().then(function(n){e(n)}),f.push(e);var r=function(){var n=f.indexOf(e);n>-1&&f.splice(n,1)};return n&&n.$on("$destroy",r),r}};return o.$on("$firebaseSimpleLogin:login",u),o.$on("$firebaseSimpleLogin:logout",u),o.$on("$firebaseSimpleLogin:error",u),u(),s}]).factory("createProfile",["fbutil","$q","$timeout",function(e,n,r){return function(t,i,o){function u(e){return c(e.substr(0,e.indexOf("@"))||"")}function c(e){e+="";var n=e.charAt(0).toUpperCase();return n+e.substr(1)}var f=e.ref("users",t),s=n.defer();return f.set({email:i,name:o||u(i)},function(e){r(function(){e?s.reject(e):s.resolve(f)})}),s.promise}}]);
angular.module("changeEmail",["firebase.utils"]).factory("changeEmail",["fbutil","$q",function(e,r){return function(n,t,u,o){function i(){return o.login(s.old.email,n).then(function(e){s.old.uid=e.uid})}function c(){var n=r.defer();return s.old.ref=e.ref("users",s.old.uid),s.old.ref.once("value",function(e){var r=e.val();null===r?n.reject(t+" not found"):(s.old.name=r.name,n.resolve())},function(e){n.reject(e)}),n.promise}function l(){return o.createAccount(s.curr.email,n,s.old.name).then(function(e){s.curr.uid=e.uid})}function f(){var n=r.defer();s.curr.ref=e.ref("users",s.curr.uid);var t={email:s.curr.email,name:s.old.name||""};return s.curr.ref.set(t,function(e){e?n.reject(e):n.resolve()}),n.promise}function a(){var e=r.defer();return s.old.ref.remove(function(r){r?e.reject(r):e.resolve()}),e.promise}function d(){var e=r.defer();return o.removeUser(s.old.email,n).then(function(){e.resolve()},function(r){e.reject(r)}),e.promise}function m(){return o.login(s.curr.email,n)}var s={old:{email:t},curr:{email:u}};return i().then(c).then(l).then(f).then(i).then(a).then(d).then(m).catch(function(e){return console.error(e),r.reject(e)})}}]);
"use strict";myAppControllers.controller("ContactsCtrl",["$scope","contactsList","fbutil",function(o,n,a){console.log("ContactsCtrl"),o.contacts=n,o.addPerson=function(n){if(n){console.log("Ok add person: ",n);var a=o.contacts.$add({firstName:n.firstName,lastName:n.lastName});a.then(function(o){console.log("add person path: ",o.path.toString())})}};var t=a.ref("contacts");t.on("child_added",function(o){console.log("child added!");var n=a.ref("contacts/"+o.name());n.child("id").set(o.name())}),o.remove=function(o,n){var t=a.ref("contacts");console.log("delete this person: ",n),console.log("person: ",n),console.log("person ",n.$id);var c=a.ref("contacts/"+n.$id);c.remove(),t.once("value",function(o){var n=o.val();console.log("value: ",n)})},o.testData=function(){var o=a.ref("contacts");o.once("value",function(o){o.val(),o.name();o.forEach(function(o){console.log("21:56 -> child: ",o),console.log("contact | value: ",o.val());var n=o.val().contacts.id;console.log("id: ",n)});var t=n;angular.forEach(t,function(o){var n=(a.ref(o.$id),a.ref("contacts/"+o.$id));n.child("new").update({name:"grace"})})})};o.removeAll=function(){var o=a.ref("contacts");o.remove()},o.addToAll=function(){var o={id:"-JaoxFN-jOvFxyt-WkL6"},n=a.ref("contacts");n.once("value",function(n){{var t=n.val();n.name()}angular.forEach(t,function(n){var t=a.ref("contacts/"+n.id);t.child("contacts").update(o)})})}}]);
"use strict";angular.module("myApp.directives"),myApp.directive("person",[function(){return{restrict:"EA",scope:{thePerson:"="},controller:function(e){console.log("person"),e.remove=function(o){console.log("remove: ",o),console.log("the: ",e.thePerson.firstName)}},link:function(){},templateUrl:"partials/person.html"}}]);